<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å‡åˆ¥çµ±è¨ˆå·¥å…·</title>
    <style>
        table, th, td {
            border: 1px solid #aaa;
            border-collapse: collapse;
            padding: 4px;
            text-align: center;
            width: 50px;
        }
        th {
            background-color: #f0f0f0;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        input[type="number"] {
            width: 60px;
        }
        .totals {
            margin-top: 20px;
            white-space: pre-wrap;
            background-color: #f9f9f9;
            padding: 10px;
            border: 1px dashed #ccc;
        }
        .weekend {
            font-weight: bold;
        }
        .saturday {
            background-color: #e6f7ff; /* é€±å…­çš„èƒŒæ™¯é¡è‰² */
        }
        .sunday {
            background-color: #ffe6e6; /* é€±æ—¥çš„èƒŒæ™¯é¡è‰² */
        }
        tr.weekend-row:hover {
            background-color: #f0f0f0; /* æ»‘é¼ æ‡¸åœæ™‚çš„è®Šè‰² */
        }
        .import-button {
            margin-top: 10px;
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .import-button:hover {
            background-color: #45a049;
        }
        .date-input {
            width: 80px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h2>å‡åˆ¥ç™»è¨˜èˆ‡çµ±è¨ˆå·¥å…·</h2>
    <label>è€å¸«å§“åï¼ˆéå¿…å¡«ï¼‰ï¼š<input type="text" id="teacherNameLeave"></label><br><br>
    <label>å¹´ä»½ï¼š<input type="number" id="yearInput" value="" min="2000" max="2100"></label>
    <label>æœˆä»½ï¼ˆ1~12ï¼‰ï¼š<input type="number" id="monthInput" value="5" min="1" max="12"></label>
    <button onclick="generateTable()">ç”¢ç”Ÿæ—¥æœŸè¡¨</button>

    <div id="formArea"></div>
    <button onclick="calculateLeave()">çµ±è¨ˆçµæœ</button>

    <h3>çµ±è¨ˆçµæœï¼ˆå¯è¤‡è£½ï¼‰ï¼š</h3>
    <button onclick="copyResultsLeave()">ğŸ“‹ è¤‡è£½çµæœ</button>
    <div class="totals" id="resultsLeave" contenteditable="true"></div>
    <button class="import-button" onclick="importLeaveResults()">â” åŒ¯å…¥ä¸è¨ˆè–ªè¨ˆç®—</button>

    <hr>

    <h2>ğŸ§®äº‹ç—…å‡ æˆ– é²åˆ° ä¸è¨ˆè–ªè¨ˆç®—å™¨</h2>

    <label>è€å¸«å§“åï¼ˆå¯ç•™ç©ºï¼‰ï¼š</label>
    <input type="text" id="nameSalary" placeholder="ä¾‹å¦‚ï¼šå¼µè€å¸«"><br>

    <label>åŸå§‹æœˆè–ªï¼š</label>
    <input type="number" id="salary" style="width: 100px;" placeholder="ä¾‹å¦‚ï¼š32000"><br>

    <label>äº‹å‡ï¼ˆå¤©ï¼‰ï¼š</label>
    <input type="number" id="leaveDaysSalary" placeholder="ä¾‹å¦‚ï¼š1">

    <label>äº‹å‡ï¼ˆå°æ™‚ï¼‰ï¼š</label>
    <input type="number" id="leaveHoursSalary" placeholder="ä¾‹å¦‚ï¼š2">

    <label>ç—…å‡ï¼ˆå¤©ï¼‰ï¼š</label>
    <input type="number" id="sickDaysSalary" placeholder="ä¾‹å¦‚ï¼š0.5">

    <label>ç—…å‡ï¼ˆå°æ™‚ï¼‰ï¼š</label>
    <input type="number" id="sickHoursSalary" placeholder="ä¾‹å¦‚ï¼š1">

    <label>è¶…éä¸‰æ¬¡5åˆ†é˜çš„é²åˆ°ï¼ˆåˆ†é˜ï¼‰ï¼š</label>
    <input type="number" id="lateMinutesSalary" placeholder="ä¾‹å¦‚ï¼š15">

    <button onclick="calculateSalaryDeduction()">è¨ˆç®—</button>
    <div id="salaryResult"></div>
    <button onclick="copyResultsSalary()">ğŸ“‹ è¤‡è£½ç®—å¼</button>

    <script>
        // é è¨­ç‚ºç•¶å‰å¹´ä»½
        document.getElementById("yearInput").value = new Date().getFullYear();

        function generateTable() {
            const year = parseInt(document.getElementById("yearInput").value);
            const month = parseInt(document.getElementById("monthInput").value);
            const daysInMonth = new Date(year, month, 0).getDate();

            let html = '<table><tr><th>æ—¥æœŸ</th><th>æ˜ŸæœŸ</th><th>ç‰¹ä¼‘ (å¤©)</th><th>ç‰¹ä¼‘ (æ™‚)</th><th>äº‹å‡ (å¤©)</th><th>äº‹å‡ (æ™‚)</th><th>ç—…å‡ (å¤©)</th><th>ç—…å‡ (æ™‚)</th><th>é²åˆ° (åˆ†é˜)</th></tr>';

            const weekDays = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"];  // æ˜ŸæœŸçš„é¡¯ç¤ºæ ¼å¼

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month - 1, day);  // æœˆä»½æ˜¯å¾ 0 é–‹å§‹
                const displayDate = `${month}/${day}`;
                const dayOfWeek = date.getDay();  // 0: Sunday, 1: Monday, ..., 6: Saturday

                let weekendClass = "";
                if (dayOfWeek === 6) {  // Saturday
                    weekendClass = "saturday";
                } else if (dayOfWeek === 0) {  // Sunday
                    weekendClass = "sunday";
                }

                html += `<tr class="weekend-row ${weekendClass}">
                    <td>${displayDate}</td>
                    <td>(${weekDays[dayOfWeek]})</td>
                    <td><input type="number" name="leave-v" data-type="v-day" onchange="validateInput(this)"></td>
                    <td><input type="number" name="leave-v" data-type="v-hour" onchange="validateInput(this)"></td>
                    <td>
                        <input type="number" name="leave-p" data-type="p-day" onchange="validateInput(this)">
                        <input type="hidden" name="leave-p-date" value="${displayDate}">
                    </td>
                    <td>
                        <input type="number" name="leave-p" data-type="p-hour" onchange="validateInput(this)">
                        <input type="hidden" name="leave-p-date" value="${displayDate}">
                    </td>
                    <td>
                        <input type="number" name="leave-s" data-type="s-day" onchange="validateInput(this)">
                        <input type="hidden" name="leave-s-date" value="${displayDate}">
                    </td>
                    <td>
                        <input type="number" name="leave-s" data-type="s-hour" onchange="validateInput(this)">
                        <input type="hidden" name="leave-s-date" value="${displayDate}">
                    </td>
                    <td>
                        <input type="number" name="late" data-type="late-min" onchange="validateInput(this)">
                        <input type="hidden" name="late-date" value="${displayDate}">
                    </td>
                </tr>`;
            }

            html += '</table>';
            document.getElementById("formArea").innerHTML = html;
            document.getElementById("resultsLeave").innerText = '';
        }

        function validateInput(input) {
            let value = parseFloat(input.value) || 0;

            // é˜²å‘†æ©Ÿåˆ¶ï¼šç¦æ­¢è¼¸å…¥è² æ•¸
            if (value < 0) {
                alert("æ•¸å€¼ä¸èƒ½æ˜¯è² æ•¸ï¼");
                input.value = 0; // è¨­å®šç‚º 0
                return;
            }

            // é˜²å‘†æ©Ÿåˆ¶ï¼šç‰¹ä¼‘ã€äº‹å‡ã€ç—…å‡å¡«å¯«æ™‚ä¸èƒ½è¶…é 1 å¤©
            const dataType = input.getAttribute("data-type");
            if (dataType.includes("day") && value > 1) {
                alert("å‡åˆ¥ï¼ˆå¤©ï¼‰ä¸èƒ½è¶…é 1 å¤©ï¼");
                input.value = 1;
            }

            // é˜²å‘†æ©Ÿåˆ¶ï¼šæ¯æ ¼æœ€å¤šå¡« 8 å°æ™‚
            if (dataType.includes("hour") && value > 8) {
                alert("æ¯æ ¼æœ€å¤šå¡«å¯« 8 å°æ™‚ï¼");
                input.value = 8; // è¨­å®šç‚º 8 å°æ™‚
            }
        }

        let leaveRecords = [];
        let sickRecords = [];
        let lateRecords = [];

        function calculateLeave() {
            const rows = document.querySelectorAll("#formArea table tr:not(:first-child)");
            leaveRecords = [];
            sickRecords = [];
            lateRecords = [];
            let vDay = 0, vHour = 0, pDay = 0, pHour = 0, sDay = 0, sHour = 0, lateMin = 0;

            rows.forEach(row => {
                const date = row.querySelector("td:first-child").innerText;
                const inputs = row.querySelectorAll("input[type='number']");
                const pDateInput = row.querySelectorAll("input[type='hidden'][name$='-p-date']");
                const sDateInput = row.querySelectorAll("input[type='hidden'][name$='-s-date']");
                const lateDateInput = row.querySelectorAll("input[type='hidden'][name$='late-date']");


                const vDayVal = parseFloat(inputs[0].value) || 0;
                const vHourVal = parseFloat(inputs[1].value) || 0;
                const pDayVal = parseFloat(inputs[2].value) || 0;
                const pHourVal = parseFloat(inputs[3].value) || 0;
                const sDayVal = parseFloat(inputs[4].value) || 0;
                const sHourVal = parseFloat(inputs[5].value) || 0;
                const lateMinVal = parseFloat(inputs[6].value) || 0;

                vDay += vDayVal;
                vHour += vHourVal;
                pDay += pDayVal;
                pHour += pHourVal;
                sDay += sDayVal;
                sHour += sHourVal;
                lateMin += lateMinVal;

                if (pDayVal > 0) leaveRecords.push({ days: pDayVal, date: pDateInput[0].value });
                if (pHourVal > 0) leaveRecords.push({ hours: pHourVal, date: pDateInput[1].value });
                if (sDayVal > 0) sickRecords.push({ days: sDayVal, date: sDateInput[0].value });
                if (sHourVal > 0) sickRecords.push({ hours: sHourVal, date: sDateInput[1].value });
                if (lateMinVal > 0) lateRecords.push({ minutes: lateMinVal, date: lateDateInput[0].value });
            });

            const name = document.getElementById("teacherNameLeave").value.trim();
            const head = name ? `ğŸ”¹${name}è€å¸«å‡åˆ¥çµ±è¨ˆçµæœï¼š\n` : '';

            const result = `${head}âœ… ç‰¹ä¼‘ï¼š${vDay} å¤© ${vHour} å°æ™‚
âœ… äº‹å‡ï¼š${pDay} å¤© ${pHour} å°æ™‚
âœ… ç—…å‡ï¼š${sDay} å¤© ${sHour} å°æ™‚
âœ… é²åˆ°ï¼š${lateMin} åˆ†é˜`;

            document.getElementById("resultsLeave").innerText = result;
        }

        function copyResultsLeave() {
            const resultText = document.getElementById("resultsLeave").innerText;
            navigator.clipboard.writeText(resultText).then(() => {
                alert("å·²è¤‡è£½çµ±è¨ˆçµæœï¼");
            }, () => {
                alert("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–å…§å®¹ï¼");
            });
        }

        function importLeaveResults() {
            let totalLeaveDays = 0;
            let totalLeaveHours = 0;
            leaveRecords.forEach(record => {
                if (record.days) totalLeaveDays += record.days;
                if (record.hours) totalLeaveHours += record.hours;
            });

            let totalSickDays = 0;
            let totalSickHours = 0;
            sickRecords.forEach(record => {
                if (record.days) totalSickDays += record.days;
                if (record.hours) totalSickHours += record.hours;
            });

            let totalLateMinutes = 0;
            lateRecords.forEach(record => {
                if (record.minutes) totalLateMinutes += record.minutes;
            });

            document.getElementById("leaveDaysSalary").value = totalLeaveDays;
            document.getElementById("leaveHoursSalary").value = totalLeaveHours;
            document.getElementById("sickDaysSalary").value = totalSickDays;
            document.getElementById("sickHoursSalary").value = totalSickHours;
            document.getElementById("lateMinutesSalary").value = totalLateMinutes;

            const teacherNameLeave = document.getElementById("teacherNameLeave").value.trim();
            if (teacherNameLeave) {
                document.getElementById("nameSalary").value = teacherNameLeave;
            }

            alert("å‡åˆ¥çµ±è¨ˆçµæœå·²åŒ¯å…¥ä¸è¨ˆè–ªè¨ˆç®—ï¼");
        }
    </script>

    <hr>

    <script>
        function getValue(id) {
            const val = parseFloat(document.getElementById(id).value);
            return isNaN(val) ? 0 : val;
        }

        function calculateSalaryDeduction() {
            const name = document.getElementById("nameSalary").value.trim();
            const salary = getValue("salary");
            const leaveDays = getValue("leaveDaysSalary");
            const leaveHours = getValue("leaveHoursSalary");
            const sickDays = getValue("sickDaysSalary");
            const sickHours = getValue("sickHoursSalary");
            const lateMinutes = getValue("lateMinutesSalary");

            let leaveDaysNote = "";
            leaveRecords.forEach(record => {
                if (record.days) leaveDaysNote += `ï¼ˆ${record.date} ${record.days}å¤©ï¼‰`;
            });

            let leaveHoursNote = "";
            leaveRecords.forEach(record => {
                if (record.hours) leaveHoursNote += `ï¼ˆ${record.date} ${record.hours}å°æ™‚ï¼‰`;
            });

            let sickDaysNote = "";
            sickRecords.forEach(record => {
                if (record.days) sickDaysNote += `ï¼ˆ${record.date} ${record.days}å¤©ï¼‰`;
            });

            let sickHoursNote = "";
            sickRecords.forEach(record => {
                if (record.hours) sickHoursNote += `ï¼ˆ${record.date} ${record.hours}å°æ™‚ï¼‰`;
            });

            let lateNote = "";
            lateRecords.forEach(record => {
                if (record.minutes) lateNote += `ï¼ˆ${record.date} ${record.minutes}åˆ†é˜ï¼‰`;
            });


            if (salary <= 0) {
                document.getElementById("salaryResult").innerText = "âš ï¸ è«‹å¡«å…¥åŸå§‹æœˆè–ª";
                return;
            }

            const leaveDayDeduct = Math.floor((salary / 30) * leaveDays);
            const leaveHourDeduct = Math.floor((salary / 30 / 8) * leaveHours);
            const sickDayDeduct = Math.floor((salary / 30 / 2) * sickDays);
            const sickHourDeduct = Math.floor((salary / 30 / 8 / 2) * sickHours);
            const lateDeduct = Math.floor((salary / 30 / 8 / 60) * lateMinutes);

            const totalDeduct = leaveDayDeduct + leaveHourDeduct + sickDayDeduct + sickHourDeduct + lateDeduct;
            const finalPay = Math.floor(salary - totalDeduct);

            let formula = `${name ? name + "ï¼š" : ""}åŸå§‹æœˆè–ª ${salary}å…ƒ\n`;

            if (leaveDays) formula += `ï¼ äº‹å‡ ${leaveDays}å¤© Ã— ${salary}/30 = ${leaveDayDeduct}å…ƒ ${leaveDaysNote}\n`;
            if (leaveHours) formula += `ï¼ äº‹å‡ ${leaveHours}å°æ™‚ Ã— ${salary}/30/8 = ${leaveHourDeduct}å…ƒ ${leaveHoursNote}\n`;
            if (sickDays) formula += `ï¼ ç—…å‡ ${sickDays}å¤© Ã— ${salary}/30/2 = ${sickDayDeduct}å…ƒ ${sickDaysNote}\n`;
            if (sickHours) formula += `ï¼ ç—…å‡ ${sickHours}å°æ™‚ Ã— ${salary}/30/8/2 = ${sickHourDeduct}å…ƒ ${sickHoursNote}\n`;
            if (lateMinutes) formula += `ï¼ é²åˆ° ${lateMinutes}åˆ†é˜ Ã— ${salary}/30/8/60 = ${lateDeduct}å…ƒ ${lateNote}\n`;

            formula += `ï¼ æœ¬æ¬¡æ‰€å¾—ï¼š${finalPay}å…ƒ`;

            document.getElementById("salaryResult").innerText = formula;
        }

        function copyResultsSalary() {
            const text = document.getElementById("salaryResult").innerText;
            if (!text) {
                alert("âš ï¸ å°šæœªç”¢ç”Ÿçµæœ");
                return;
            }
            navigator.clipboard.writeText(text)
                .then(() => alert("âœ… å·²è¤‡è£½ç®—å¼ï¼"))
                .catch(err => alert("âŒ è¤‡è£½å¤±æ•—ï¼š" + err));
        }
    </script>
</body>
</html>
