<!DOCTYPE html>  
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>è¯çµ¡ç°¿åæ¢ç”¢ç”Ÿå™¨V0123</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
/* =========================
   Design System (Tokens)
   ========================= */
:root{
  /* ä¸»è‰²ï¼šä½ æŒ‡å®šçš„è‰²ç¥¨ */
  --brand-500:#A1C6EA;   /* ä¸»è¦ï¼šç”¢ç”Ÿ */
  --brand-600:#8FB9E2;   /* ä¸»è¦ hoverï¼ˆç•¥æ·±ï¼‰ */

  --secondary-500:#BBD1EA; /* æ¬¡è¦ï¼šä¸‹è¼‰ */
  --secondary-600:#A8C5E6; /* æ¬¡è¦ hoverï¼ˆç•¥æ·±ï¼‰ */

  --clear-500:#DAE3E5;   /* æ¸…ç©º */
  --clear-600:#CFD9DC;   /* æ¸…ç©º hoverï¼ˆç•¥æ·±ï¼‰ */

  /* å…¶ä»–ç³»çµ±è‰²ï¼ˆä¿ç•™ï¼‰ */
  --text-strong:#1f2937; --text-normal:#374151; --text-mute:#6b7280;
  --border:#d1d5db; --border-strong:#9ca3af;
  --bg-page:#f0f2f5; --bg-card:#ffffff; --bg-info:#f8fbff; --bg-info-border:#e1eefc;

  --font-sans:"Microsoft JhengHei","å¾®è»Ÿæ­£é»‘é«”","Noto Sans TC","PingFang TC","Heiti TC",sans-serif;
  --font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;

  --radius-sm:6px; --radius-md:8px; --radius-lg:12px;
  --shadow-sm:0 1px 3px rgba(0,0,0,0.08);
  --shadow-md:0 2px 10px rgba(0,0,0,0.10);
  --shadow-lg:0 4px 20px rgba(0,0,0,0.12);

  --space-1:.25rem; --space-2:.5rem; --space-3:.75rem; --space-4:1rem; --space-5:1.25rem; --space-6:1.5rem;
  --input-height:2.75rem; --btn-height:2.9rem;

  --focus-ring:0 0 0 3px rgba(106,154,255,0.25);
  --focus-border:#6a9aff;

  /* æŒ‰éˆ•æ–‡å­—é¡è‰²ï¼ˆæ·±è‰²â†’èˆ‡æ·¡è‰²èƒŒæ™¯æœ‰è¶³å¤ å°æ¯”ï¼‰ */
  --btn-text:#17324A;
}

/* =========================
   Base
   ========================= */
*{box-sizing:border-box}
html,body{height:100%}
body{
  font-family:var(--font-sans); background:var(--bg-page);
  margin:0; padding:0; display:flex; justify-content:center; align-items:flex-start; min-height:100vh;
  color:var(--text-normal);
}
.container{
  background:var(--bg-card); padding:2rem; margin:2rem 1rem; border-radius:var(--radius-lg);
  box-shadow:var(--shadow-lg); max-width:960px; width:100%;
}
h1{margin:0 0 var(--space-4); color:#0056b3; text-align:center; font-weight:800;}
h2,h3{color:var(--text-strong); border-bottom:2px solid #e0e0e0; padding-bottom:.5rem; margin-top:1.5rem; margin-bottom:1rem;}
label{font-weight:700; display:block; color:#555; margin-bottom:.5rem;}
p{color:#444; font-size:.95rem; line-height:1.6}

/* =========================
   è¡¨å–®å…ƒä»¶
   ========================= */
textarea,
input[type="text"],
input[type="number"],
input[type="search"],
input[type="email"],
input[type="tel"],
select{
  width:100%; height:var(--input-height); padding:0 var(--space-4);
  border-radius:var(--radius-md); border:1px solid var(--border);
  font-size:16px; transition:border-color .2s, box-shadow .2s, background-color .2s;
  background:#fff; color:var(--text-normal);
}
textarea{
  height:auto; min-height:220px; resize:vertical; padding:var(--space-3); line-height:1.5;
  font-family:var(--font-mono); width:calc(100% - 1rem);
}
textarea:focus, input:focus, select:focus{ outline:none; border-color:var(--focus-border)!important; box-shadow:var(--focus-ring); }

/* ä¸‹æ‹‰ï¼šå»¶ç”¨èˆŠè—ä½œç‚ºè¾¨è­˜ï¼ˆå¯æ”¹æˆä½ çš„å“ç‰Œè‰²ä¹Ÿè¡Œï¼‰ */
select{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  cursor:pointer; color:#fff; background:#4e73df; border-color:#4e73df;
  padding-right:2.2rem;
  background-image:
    linear-gradient(45deg,transparent 50%,#fff 50%),
    linear-gradient(135deg,#fff 50%,transparent 50%);
  background-position: calc(100% - 16px) calc(50% - 3px), calc(100% - 11px) calc(50% - 3px);
  background-size:6px 6px; background-repeat:no-repeat;
}
select:hover{background:#2e59d9; border-color:#2e59d9}
select:focus{box-shadow:var(--focus-ring); border-color:var(--focus-border)}
select::-ms-expand{display:none}

/* =========================
   æŒ‰éˆ•
   ========================= */
button{
  display:inline-flex; align-items:center; justify-content:center;
  min-height:var(--btn-height); padding:0 var(--space-5);
  font-size:17px; font-weight:700; border:none; border-radius:var(--radius-md);
  cursor:pointer; color:var(--btn-text);
  background:var(--brand-500);
  transition:background-color .15s ease, transform .12s ease, box-shadow .2s;
  box-shadow:var(--shadow-sm);
}
button:hover{background:var(--brand-600); transform:translateY(-2px)}
button:active{transform:translateY(-1px)}
button:focus{outline:none; box-shadow:var(--focus-ring)}

/* æ¬¡è¦ï¼ˆä¸‹è¼‰ï¼‰ */
.btn.btn-secondary{ background:var(--secondary-500); color:var(--btn-text); }
.btn.btn-secondary:hover{ background:var(--secondary-600); }

/* æ¸…ç©ºï¼ˆä½¿ç”¨ä½ æŒ‡å®šçš„ç°è—ï¼‰ */
.btn--clear{ background:var(--clear-500); color:var(--btn-text); }
.btn--clear:hover{ background:var(--clear-600); }

/* æŒ‰éˆ•åˆ—ç½®ä¸­ + åŒå¯¬ */
.row.buttons{
  display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap; margin-top:.5rem;
}
.row.buttons .btn{ width:200px; margin:0; }
.row{ display:flex; gap:10px; flex-wrap:wrap; }

/* =========================
   é è¦½å€ï¼ˆä¿æŒä¸è®Šï¼‰
   ========================= */
#previewWrap{ overflow:auto; border:1px solid #ddd; padding:10px; border-radius:var(--radius-md); background:#fff; box-shadow:var(--shadow-sm); }
table.nameTable{ border-collapse:collapse; table-layout:fixed; }
td.namecell{ width:63.5mm; height:50mm; border:1pt solid black; vertical-align:top; padding:4mm 3mm; box-sizing:border-box; }
.nm{ font-size:28pt; line-height:35pt; font-weight:bold; letter-spacing:1pt; }
.fd{ font-size:18pt; line-height:35pt; }
.hint{ margin-top:8px; color:#444; font-size:14px; }

/* =========================
   åˆ—å°ï¼ˆä¿ç•™ï¼‰
   ========================= */
@media print{
  @page{ size:A4 portrait; margin:.8cm; }
  body>*:not(.container), .container>*:not(.output-container){ display:none!important; }
  .output-container{ margin-top:0; padding:0; box-shadow:none; }
  .output-grid{ grid-template-columns:repeat(3,6.5cm); gap:0; margin:0 auto; }
  .slip{ border:.5px solid #000; }
  .slip pre{ font-size:10.5pt; line-height:1.1; }
  .student-name{ font-size:13pt; }
  .total-voucher-info, .no-data-message{ display:none!important; }
}

/* çµ±ä¸€èšç„¦é˜²å‘† */
input[type="text"]:focus,
input[type="number"]:focus,
input[type="search"]:focus,
input[type="email"]:focus,
input[type="tel"]:focus,
textarea:focus,
select:focus{
  outline:none; border-color:var(--focus-border)!important; box-shadow:var(--focus-ring);
}
  </style>
</head>
<body>
  <div class="container">
    <h1>è¯çµ¡æœ¬å°é¢åæ¢ç”¢ç”Ÿå™¨</h1>

    <div class="input-area">
      <label>å¾EXCELè²¼ä¸Šå­¸ç”Ÿå§“åèˆ‡ç­ç´šè³‡æ–™ï¼ˆå«æ¨™é¡Œåˆ—ï¼‰ï¼ˆæ¸…æ°´ã€æ±Ÿç¿ å¯å¾é»åè¡¨è²¼ä¸Šè³‡æ–™ï¼‰</label>
      <textarea id="rawData" rows="12" placeholder='ä¾‹ï¼š
å§“åã€€ç­ç´š
å¼µå°é£› æ±Ÿ101

æˆ– 
å§“åã€€ç­ç´š/ç¾èªç­
å¼µå°é£›Flyã€€æ¸…æ°´101 ç¾TE

æˆ–
å§“å
å¼µå°é£›

ç³»çµ±æœƒæŠ“å‡ºä¸­æ–‡å§“åèˆ‡åœ‹å°ç­ç´šï¼Œ
è«‹ç›´æ¥å¾ Excel/è©¦ç®—è¡¨ï¼ˆå«æ¨™é¡Œåˆ—ï¼‰æ•´å¡Šè¤‡è£½è²¼ä¸Š'></textarea>

      <div class="row">
        <div style="flex:1 1 180px">
          <label>èª²è¼”ç­ç´šï¼ˆé¡¯ç¤ºæ–¼åæ¢ï¼‰</label>
          <input type="text" id="groupClass" value="ä¸€A">
        </div>
        <div style="flex:1 1 180px">
          <label>å°å¸«</label>
          <input type="text" id="teacher" value="åœˆåœˆè€å¸«">
        </div>
        <div style="flex:1 1 180px">
          <label>è¯çµ¡é›»è©±</label>
          <input type="text" id="phone" value="2233-1997#123">
        </div>
      </div>

      <div class="row buttons">
        <button class="btn" onclick="generateNamecards()">ç”¢ç”Ÿåæ¢</button>
        <button class="btn btn-secondary" onclick="downloadDocNarrow()">â¬‡ï¸ ä¸‹è¼‰ Word</button>
        <button class="btn btn--clear" onclick="clearAll()">ğŸ§¹ æ¸…ç©º</button>
      </div>
      <p class="hint">ğŸ“ å°æé†’ï¼šä¸‹è¼‰å¾Œè«‹åœ¨ <b>Word â†’ ç‰ˆé¢é…ç½® â†’ é‚Šç•Œ â†’ é¸ã€Œçª„ã€</b>ï¼ˆ1.27cmï¼‰ï¼Œæ‰èƒ½æ­£ç¢ºé¡¯ç¤ºç‚º 3 æ¬„ 63.5Ã—50mmã€‚</p>
    </div>

    <div id="errorLog"></div>
    <div id="previewWrap"><div id="outputTable" contenteditable="true"></div></div>
  </div>

  <script>
    /* ========= TSV è§£æï¼ˆæ”¯æ´å¼•è™Ÿèˆ‡å„²å­˜æ ¼å…§æ›è¡Œï¼‰ ========= */
    function parseTSVWithQuotes(raw) {
      const rows = []; let row=[]; let cell=''; let inQ=false;
      for(let i=0;i<raw.length;i++){
        const ch = raw[i];
        if(ch === '"'){ if(inQ && raw[i+1] === '"'){ cell+='"'; i++; } else { inQ=!inQ; } continue; }
        if(!inQ && ch === '\t'){ row.push(cell); cell=''; continue; }
        if(!inQ && ch === '\n'){ row.push(cell); rows.push(row); row=[]; cell=''; continue; }
        if(ch !== '\r') cell += ch;
      }
      row.push(cell); rows.push(row);
      return rows.map(r => r.map(c => String(c).replace(/^\s+|\s+$/g,'').replace(/^"|"$/g,'')));
    }

    function detectHeader(cells){
      const isName  = (h)=>/^(ä¸­æ–‡å§“å|å§“å)/.test(h);
      const isClass = (h)=>/(å­¸æ ¡ç­ç´š|è‹±æ–‡ç­ç´š|ç­ç´š\s*\/?\s*ç¾èªç­|^\s*ç­ç´š\s*$)/.test(h);
      const nameIdx = cells.findIndex(isName);
      const classIdx= cells.findIndex(isClass);
      if(nameIdx!==-1 && classIdx!==-1) return {nameIdx,classIdx};
      return null;
    }

    function parseInput(raw){
  const isHeaderOnlyName = (s)=>/^(ä¸­æ–‡å§“å|å§“å)\s*$/i.test(String(s||'').trim());

  // âœ… åªè¦å…§å®¹å«æœ‰é›™å¼•è™Ÿï¼ˆä¾‹å¦‚ "æ—å­ç¡¯â†µANDY"ï¼‰ï¼Œå°±ç”¨ quote è§£æå™¨ï¼Œ
  //    é€™æ¨£å„²å­˜æ ¼å…§æ›è¡Œä¸æœƒè¢«åˆ‡å£
  const shouldUseQuoteParser = raw.includes('"');

  if(raw.includes('\t') || shouldUseQuoteParser){
    const rows = parseTSVWithQuotes(raw);
    let header = detectHeader(rows[0].map(x=>x.replace(/"/g,'').trim()));
    let start = header ? 1 : 0;
    const out = [];

    for(let i=start;i<rows.length;i++){
      const r = rows[i];
      if(!r || r.every(x=>!String(x).trim())) continue;

      // åªè²¼å§“åæ™‚ï¼Œç•¥éã€Œå§“åã€é‚£è¡Œ
      if(!header && isHeaderOnlyName(r[0])) continue;

      if(header){
        const nameCell = r[header.nameIdx]||'';
        const classCell= r[header.classIdx]||'';

        // âœ… ä¸­æ–‡å§“åï¼šä¸è¦æ±‚åœ¨å­—é¦–ï¼Œé¿å…å‰é¢æœ‰å¼•è™Ÿæˆ–ç©ºç™½
        const name = (String(nameCell).match(/[\u4e00-\u9fa5]{1,6}/)||[''])[0];

        // âœ… ç­ç´šç…§èˆŠï¼ˆæœ‰å°±æŠ“ï¼Œæ²’æœ‰å°±ç•™ç©º => åªé¡¯ç¤ºèª²è¼”ç­ç´šï¼‰
        const sc   = (String(classCell).match(/[\u4e00-\u9fa5]{1,12}\s*\d{3}/)||[''])[0].replace(/\s+/g,'');

        if(name && sc) out.push({name, schoolClass: sc});
        else if(name && !sc) out.push({name, schoolClass: ''});
        else out.push({error:`âŒ ç„¡æ³•è§£æï¼š${r.join('  |  ')}`});
      }else{
        // âœ… å–®æ¬„/ç„¡æ¨™é¡Œï¼šæŠŠæ•´æ ¼ç•¶å§“åä¾†æºï¼ˆå³ä½¿å…§å« ANDY/SUNNY ä¹Ÿæ²’é—œä¿‚ï¼‰
        const whole = String(r[0]||'');
        const name = (whole.match(/[\u4e00-\u9fa5]{1,6}/)||[''])[0];

        // å¦‚æœç¬¬äºŒæ¬„å‰›å¥½æœ‰ç­ç´šä¹Ÿç…§æŠ“ï¼ˆæ²’ä¹Ÿæ²’é—œä¿‚ï¼‰
        const sc   = (String(r[1]||'').match(/[\u4e00-\u9fa5]{1,12}\s*\d{3}/)||[''])[0].replace(/\s+/g,'');

        if(name && sc) out.push({name, schoolClass: sc});
        else if(name && !sc) out.push({name, schoolClass: ''});
        else out.push({error:`âŒ ç„¡æ³•è§£æï¼š${r.join('  |  ')}`});
      }
    }
    return out;
  }

  // å…¶ä»–ç´”æ–‡å­—ï¼ˆæ²’æœ‰å¼•è™Ÿä¹Ÿæ²’æœ‰ tabï¼‰ç¶­æŒåŸæœ¬é‚è¼¯ï¼Œä½†å§“åæŠ“å–æ”¹æˆä¸å¿…åœ¨å­—é¦–
  return raw.replace(/\r/g,'').split(/\n+/).map(s=>{
    s=s.trim(); if(!s) return null;
    if(isHeaderOnlyName(s)) return null;

    const name=(s.match(/[\u4e00-\u9fa5]{1,6}/)||[''])[0];
    const sc=(s.match(/[\u4e00-\u9fa5]{1,12}\s*\d{3}/)||[''])[0].replace(/\s+/g,'');

    return name ? {name, schoolClass: sc || ''} : {error:`âŒ ç„¡æ³•è§£æï¼š${s}`};
  }).filter(Boolean);
}


    /* ---------- ç”¢å‡ºï¼ˆå›ºå®š 3 æ¬„ 63.5Ã—50mmï¼‰ ---------- */
    function buildTable(records, teacher, phone, groupClass){
      const perRow = 3;
      const tdStyle = 'width:63.5mm;height:50mm;border:1pt solid black;vertical-align:top;padding:4mm 3mm;box-sizing:border-box;';
      const nmStyle = 'font-size:28pt;line-height:35pt;font-weight:bold;letter-spacing:1pt;';
      const fdStyle = 'font-size:18pt;line-height:35pt;';
      let html = '<table class="nameTable" style="border-collapse:collapse;table-layout:fixed;mso-table-lspace:0pt;mso-table-rspace:0pt;"><tbody>';
      let row = [];
      records.forEach(r=>{
        const line2 = r.schoolClass ? `${r.schoolClass} ï¼ ${groupClass}` : `${groupClass}`;
        const cell = `
<td class="namecell" style="${tdStyle}">
  <div class="nm" style="${nmStyle}">${r.name}</div>
  <div class="fd" style="${fdStyle}">${line2}</div>
  <div class="fd" style="${fdStyle}">${teacher}</div>
  <div class="fd" style="${fdStyle}">${phone}</div>
</td>`;
        row.push(cell);
        if(row.length===perRow){ html += `<tr>${row.join('')}</tr>`; row=[]; }
      });
      if(row.length){ while(row.length<perRow) row.push(`<td class="namecell" style="${tdStyle}"></td>`); html += `<tr>${row.join('')}</tr>`; }
      html += '</tbody></table>';
      return html;
    }

    function generateNamecards(){
      const teacher = document.getElementById('teacher').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const groupClass = document.getElementById('groupClass').value.trim();
      const raw = document.getElementById('rawData').value;

      const parsed = parseInput(raw);
      const errorLog = document.getElementById('errorLog'); errorLog.innerHTML = '';
      const ok = parsed.filter(x=>!x.error).length;
      parsed.filter(x=>x.error).forEach(e=>{ errorLog.innerHTML += `<div>${e.error}</div>`; });

      const records = parsed.filter(x=>!x.error);
      document.getElementById('outputTable').innerHTML = buildTable(records, teacher, phone, groupClass);
      if(ok===0 && !errorLog.innerHTML){ errorLog.innerHTML = '<div>æ²’æœ‰æˆåŠŸè§£æçš„è³‡æ–™ï¼Œè«‹æª¢æŸ¥æ ¼å¼ã€‚</div>'; }
    }

    /* ---------- Word ä¸‹è¼‰ï¼ˆã€ˆçª„ã€‰1.27cmï¼‰ + è‡ªå‹•æª”å ---------- */
    function buildWordHTML_Narrow(inner){
      return `<!DOCTYPE html>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
      xmlns:w="urn:schemas-microsoft-com:office:word"
      xmlns="http://www.w3.org/TR/REC-html40">
<head>
  <meta charset="UTF-8">
  <title>åæ¢</title>
  <style>
    @page { margin: 1.27cm; } /* Word ã€ˆçª„ã€‰ */
    body, td, div { font-family: "Microsoft JhengHei","å¾®è»Ÿæ­£é»‘é«”","Noto Sans TC","PingFang TC","Heiti TC",sans-serif; }
    table { border-collapse: collapse; table-layout: fixed; mso-table-lspace:0pt; mso-table-rspace:0pt; }
    td.namecell { width:63.5mm; height:50mm; border:1pt solid black; vertical-align:top; padding:4mm 3mm; box-sizing:border-box; }
    .nm { font-size:28pt; line-height:35pt; font-weight:bold; letter-spacing:1pt; }
    .fd { font-size:18pt; line-height:35pt; }
  </style>
</head>
<body>
${inner}
</body>
</html>`;
    }

    function downloadDocNarrow(){
      const container = document.getElementById('outputTable');
      if(!container.innerHTML.trim()){ alert('è«‹å…ˆç”¢ç”Ÿåæ¢ã€‚'); return; }
      const html = buildWordHTML_Narrow(container.innerHTML);
      const blob = new Blob([html], {type: 'application/msword;charset=utf-8'});
      const url = URL.createObjectURL(blob);

      // è‡ªå‹•æª”åï¼šç­ç´š + æ—¥æœŸ
      const cls = (document.getElementById('groupClass').value || '').trim().replace(/[\\/:*?"<>|]/g,'_');
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      const filename = `${cls||'ç­ç´š'}_è¯çµ¡æœ¬åæ¢_${yyyy}-${mm}-${dd}.doc`;

      const a = document.createElement('a'); a.href = url; a.download = filename;
      document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0);

      alert('è²¼å¿ƒæé†’ï¼šé–‹å•Ÿ Word å¾Œï¼Œè«‹åˆ°ã€Œç‰ˆé¢é…ç½® â†’ é‚Šç•Œ â†’ é¸ã€çª„ã€ï¼ˆ1.27cmï¼‰ã€æ‰èƒ½é¡¯ç¤ºæ­£ç¢ºå¤§å°ã€‚');
    }

    /* ---------- æ¸…ç©º ---------- */
    function clearAll(){
      document.getElementById('rawData').value = '';
      document.getElementById('outputTable').innerHTML = '';
      document.getElementById('errorLog').innerHTML = '';
    }
  </script>
</body>
</html>
