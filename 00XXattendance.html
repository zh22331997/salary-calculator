<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å‡åˆ¥çµ±è¨ˆå·¥å…·</title>
    <style>
        body {
            font-family: "Segoe UI", "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background-color:#D4DCDB;
            padding: 1.5em;
            color: #333;
        }

        label {
            margin-right: 0.5em;
        }

        button {
            padding: 0.5em 1em;
            background-color: #3c82f6;
            border: none;
            color: white;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
            margin-left: 1em;
        }

        button:hover {
            background-color: #2563eb;
        }

        table {  
            table-layout: fixed;
            width: 80%;/*æ”¹å¯¬åº¦*/
            border-collapse: collapse;
            margin-top: 1.5em;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        th, td {
            border: 1px solid #ddd;
            padding: 0.6em;
            text-align: center;
        }

        th {
            background-color: #f0f4f8;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        tr.sunday {
            background-color: #ffe5e5;
        }

        tr.saturday {
            background-color: #e5f0ff;
        }

        input[type="checkbox"] {
            transform: scale(1.3);
            
        }

        input[type="text"] {
            width: 6em;
            padding: 0.3em;
            margin-right: 1em;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        input[type="number"] {
            width: 4em;
            padding: 0.2em;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 1em;
        }

        /* æ¯æ¬„å¯¬åº¦è¨­å®š */
        table th:nth-child(1), table td:nth-child(1) { width: 20px; } /*æ—¥æœŸ*/
        table th:nth-child(2), table td:nth-child(2) { width: 20px; } /*æ˜ŸæœŸ*/
        table th:nth-child(3), table td:nth-child(3) { width: 30px; } /*ç‰¹ä¼‘(å¤©)*/
        table th:nth-child(4), table td:nth-child(4) { width: 50px; } /*ç‰¹ä¼‘(æ™‚)*/
        table th:nth-child(5), table td:nth-child(5) { width: 30px; } /*äº‹å‡(å¤©)*/
        table th:nth-child(6), table td:nth-child(6) { width: 50px; } /*äº‹å‡(æ™‚)*/
        table th:nth-child(7), table td:nth-child(7) { width: 30px; } /*ç—…å‡(å¤©)*/
        table th:nth-child(8), table td:nth-child(8) { width: 50px; } /*ç—…å‡(æ™‚)*/
        table th:nth-child(9), table td:nth-child(9) { width: 50px; } /*é²åˆ°æ‰£*/
        table th:nth-child(10), table td:nth-child(10) { width: 50px; } /*é²åˆ°ä¸‰æ¬¡äº”åˆ†é˜å…§(åˆ†é˜)*/
        table th:nth-child(11), table td:nth-child(11) { width: 50px; } /*æ¼æ‰“å¡*/
        table th:nth-child(12), table td:nth-child(12) { width: 50px; } /*ç”Ÿç†å‡*/
        table th:nth-child(13), table td:nth-child(13) { width: 30px; } /*å–ªå‡(å¤©)*/
        table th:nth-child(14), table td:nth-child(14) { width: 50px; } /*å–ªå‡(æ™‚)*/
        table th:nth-child(15), table td:nth-child(15) { width: 50px; } /*è¶…æ™‚(æ™‚)*/

        .totals {
            margin-top: 20px;
            white-space: pre-wrap;
            background-color: #f9f9f9;
            padding: 10px;
            border: 1px dashed #ccc;
        }

        .weekend {
            font-weight: bold;
        }

        .saturday {
            background-color: #e6f7ff;
        }

        .sunday {
            background-color: #ffe6e6;
        }

        tr.weekend-row:hover {
            background-color: #A29093;
        }

        .import-button {
            margin-top: 10px;
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .import-button:hover {
            background-color: #45a049;
        }

        .date-input {
            width: 80px;
            margin-top: 5px;
        }

        .checkbox-group {
            display: flex;
            align-items: center; /* æ°´å¹³å°é½Š */
            gap: 4px; /* èª¿æ•´é–“è· */
            flex-wrap: wrap;
            max-width: 150px;
            
        }
        
        #punchCardMissColumn {
            width: 100px;
            white-space: nowrap;
        }
        
        

    </style>

</head>
<body>
    <h2>å‡åˆ¥ç™»è¨˜èˆ‡çµ±è¨ˆå·¥å…·</h2>
    <label>è€å¸«å§“åï¼ˆå¯ç•™ç©ºï¼‰ï¼š<input type="text" id="teacherNameLeave" style="width: 100px" placeholder="ä¾‹å¦‚ï¼šå¼µæ­£è¯" oninput="calculateLeave()"></label>
    <label>ğŸ’°é è¨ˆæŠ˜ç¾ç‰¹ä¼‘ï¼ˆå¤©ï¼‰ï¼š<input type="number" id="inputCashOutDays" style="width:60px;" placeholder="0" oninput="calculateLeave()"></label>
    <label>ğŸ’°é è¨ˆæŠ˜ç¾è£œä¼‘ï¼ˆæ™‚ï¼‰ï¼š<input type="number" id="inputCashOutHours" style="width:60px;" placeholder="0" oninput="calculateLeave()"></label></br>

    <label>å¹´ä»½ï¼š<input type="number" id="yearInput" value="" min="2000" max="2100"></label>
    <label>æœˆä»½ï¼ˆ1~12ï¼‰ï¼š<input type="number" id="monthInput" value="5" min="1" max="12"></label>
    <button onclick="generateTable()">ç”¢ç”Ÿæ—¥æœŸè¡¨</button>

    <div id="formArea"></div>
    <h3>çµ±è¨ˆçµæœï¼ˆç©ºç™½è™•é»ä¸€ä¸‹ï¼Œå†æŒ‰è¤‡è£½ï¼‰ï¼š</h3>
    
    <div class="totals" id="resultsLeave" contenteditable="true"></div>
    <button onclick="copyResultsLeave()">ğŸ“‹ è¤‡è£½çµæœ</button>
    <button onclick="sendToIframe()">â” åŒ¯å…¥è³‡æ–™çµ¦ç¼ºå‹¤åˆ†æç”¢ç”Ÿè¡¨æ ¼</button>
    <button class="import-button" onclick="importLeaveResults()">â” åŒ¯å…¥ä¸æ”¯è–ªè¨ˆç®—</button>
    
    <div style="margin-top: 30px; padding: 15px; background-color: #f7f6f4; border-radius: 16px;">
    <h3 style="margin-bottom: 10px; color: #5a5a5a;">ğŸ“„ ç¼ºå‹¤åˆ†æçµæœ</h3>
    <iframe
    src="https://zh22331997.github.io/salary-calculator/ExportAttendance.html"
    width="100%"
    height="600"
    style="border: 4px solid #c2b9b0; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.08);">
    </iframe>
    </div>
    <div id="toast" style="
     position: fixed;
     bottom: 20px;
     left: 50%;
     transform: translateX(-50%);
     background-color: #323232;
     color: white;
     padding: 10px 20px;
     border-radius: 8px;
     font-size: 0.95em;
     opacity: 0;
     transition: opacity 0.5s ease;
     z-index: 1000;
     pointer-events: none;
     ">æç¤ºè¨Šæ¯</div>
     <hr>

    <h2>äº‹ç—…å‡ æˆ– é²åˆ° ä¸è¨ˆè–ªè¨ˆç®—å™¨</h2>

    <label>è€å¸«å§“åï¼ˆå¯ç•™ç©ºï¼‰ï¼š</label>
    <input type="text" id="nameSalary" style="width: 100px" placeholder="ä¾‹å¦‚ï¼šå¼µæ­£è¯"><br>

    <label>åŸå§‹æœˆè–ªï¼š</label>
    <input type="number" id="salary" style="width: 100px;" placeholder="ä¾‹å¦‚ï¼š32000"><br>

    <label>äº‹å‡ï¼ˆå¤©ï¼‰ï¼š</label>
    <input type="number" id="leaveDaysSalary" style="width: 60px" placeholder="0">

    <label>äº‹å‡ï¼ˆå°æ™‚ï¼‰ï¼š</label>
    <input type="number" id="leaveHoursSalary" style="width: 60px" placeholder="0"><br>

    <label>ç—…å‡ï¼ˆå¤©ï¼‰ï¼š</label>
    <input type="number" id="sickDaysSalary" style="width: 60px" placeholder="0">

    <label>ç—…å‡ï¼ˆå°æ™‚ï¼‰ï¼š</label>
    <input type="number" id="sickHoursSalary" style="width: 60px" placeholder="0"><br>

    <label>ç”Ÿç†å‡ï¼ˆå°æ™‚ï¼‰ï¼š</label>
    <input type="number" id="menstrualHoursSalary" style="width: 60px" placeholder="0"><br>

    <label>è¶…éä¸‰æ¬¡5åˆ†é˜çš„é²åˆ°ï¼ˆåˆ†é˜ï¼‰ï¼š</label>
    <input type="number" id="lateMinutesSalary" style="width: 60px" placeholder="0"><br>
    
    <label>æŠ˜ç¾ï¼ˆå¤©ï¼‰ï¼š</label>
    <input type="number" id="cashOutDaysSalary" style="width: 60px" placeholder="0">
    
    <label>æŠ˜ç¾ï¼ˆå°æ™‚ï¼‰ï¼š</label>
    <input type="number" id="cashOutHoursSalary" style="width: 60px" placeholder="0"><br>

    <button onclick="calculateSalaryDeduction()">è¨ˆç®—ä¸æ”¯è–ª</button><br><br>
    <div id="salaryResult"></div>
    <button onclick="copyResultsSalary()">ğŸ“‹ è¤‡è£½ç®—å¼</button>

    <script>
        document.getElementById("yearInput").value = new Date().getFullYear();

        // å…¨å±€è®Šæ•¸ç”¨æ–¼å„²å­˜è¨˜éŒ„ï¼Œä»¥ä¾¿åŒ¯å…¥
        let leaveRecords = [];
        let sickRecords = [];
        let lateRecords = [];
        let lateNoDeductRecords = [];
        let punchCardMissRecords = [];
        let menstrualRecords = [];
        let vacationRecords = [];
        let funeralRecords = [];
        let overtimeRecords = [];

        // å‡åˆ¥å¤©æ•¸é˜²å‘†æª¢æŸ¥å‡½æ•¸
        function checkLeaveDayConflict(currentCheckbox) {
            const currentRow = currentCheckbox.closest('tr');
            // ç²å–åŒåˆ—ä¸­æ‰€æœ‰ã€Œå¤©æ•¸ã€å‡åˆ¥çš„ checkbox
            const dayTypeCheckboxes = currentRow.querySelectorAll('input[type="checkbox"][data-type$="-day"]');
            // ç²å–åŒåˆ—ä¸­æ‰€æœ‰éã€Œå¤©æ•¸ã€å‡åˆ¥çš„è¼¸å…¥æ¡† (å°æ™‚æ•¸ã€åˆ†é˜æ•¸ã€æ¼æ‰“å¡)
            const otherInputsInRow = currentRow.querySelectorAll('input[type="number"], input[name="punch-card-miss"]');

            let checkedDayCount = 0;
            let currentCheckboxName = currentCheckbox.name;
            let otherCheckedDayType = '';

            dayTypeCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    checkedDayCount++;
                    if (checkbox !== currentCheckbox) {
                        otherCheckedDayType = checkbox.name;
                    }
                }
            });

            if (checkedDayCount > 1) {
                // å¦‚æœåŒæ™‚å‹¾é¸äº†å¤šå€‹ã€Œå¤©æ•¸ã€å‡åˆ¥ï¼Œå‰‡å–æ¶ˆç•¶å‰å‹¾é¸ä¸¦æç¤º
                showToast(`åŒä¸€å¤©ä¸èƒ½åŒæ™‚å‹¾é¸å¤šç¨®å‡åˆ¥çš„å¤©æ•¸ï¼`);
                currentCheckbox.checked = false; // å–æ¶ˆç•¶å‰å‹¾é¸
            } else if (checkedDayCount === 1 && currentCheckbox.checked) {
                // å¦‚æœåªå‹¾é¸äº†ä¸€å€‹ã€Œå¤©æ•¸ã€å‡åˆ¥ï¼Œå‰‡ç¦ç”¨ä¸¦æ¸…ç©ºå…¶ä»–æ‰€æœ‰æ¬„ä½
                otherInputsInRow.forEach(input => {
                    input.disabled = true;
                    if (input.type === 'number') {
                        input.value = ''; // æ¸…ç©ºæ•¸å­—è¼¸å…¥
                    } else if (input.type === 'checkbox') {
                        input.checked = false; // å–æ¶ˆå‹¾é¸æ¼æ‰“å¡
                    }
                });
            } else {
                // å¦‚æœæ²’æœ‰ä»»ä½•ã€Œå¤©æ•¸ã€å‡åˆ¥è¢«å‹¾é¸ (æˆ–è€…å–æ¶ˆå‹¾é¸äº†å”¯ä¸€çš„é‚£å€‹)ï¼Œå‰‡å•Ÿç”¨æ‰€æœ‰å…¶ä»–æ¬„ä½
                otherInputsInRow.forEach(input => {
                    input.disabled = false;
                });
            }
            calculateLeave(); // é‡æ–°è¨ˆç®—
        }


        function generateTable() {
            const year = parseInt(document.getElementById("yearInput").value);
            const month = parseInt(document.getElementById("monthInput").value);
            const daysInMonth = new Date(year, month, 0).getDate();

            let html = '<table><tr><th>æ—¥æœŸ</th><th>æ˜ŸæœŸ</th><th>ç‰¹ä¼‘<br>è£œä¼‘<br>(å¤©)</th><th>ç‰¹ä¼‘<br>è£œä¼‘<br>(æ™‚)</th><th>äº‹å‡<br>(å¤©)</th><th>äº‹å‡<br>(æ™‚)</th><th>ç—…å‡<br>(å¤©)</th><th>ç—…å‡<br>(æ™‚)</th><th>é²åˆ°æ‰£<br>(åˆ†é˜)</th><th>é²åˆ°ä¸‰æ¬¡äº”åˆ†é˜å…§<br>(åˆ†é˜)</th><th id="punchCardMissColumn">æ¼æ‰“å¡</th><th>ç”Ÿç†å‡<br>(æ™‚)</th><th>å–ªå‡<br>(å¤©)</th><th>å–ªå‡<br>(æ™‚)</th><th>è¶…æ™‚<br>(æ™‚)</th></tr>';

            const weekDays = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"];

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month - 1, day);
                const displayDate = `${month}/${day}`;
                const dayOfWeek = date.getDay();

                let weekendClass = "";
                if (dayOfWeek === 6) weekendClass = "saturday";
                else if (dayOfWeek === 0) weekendClass = "sunday";

                html += `<tr class="weekend-row ${weekendClass}">
                <td>${displayDate}</td>
                <td>(${weekDays[dayOfWeek]})</td>
                <td>
                <input type="checkbox" name="leave-v" data-type="v-day" value="1" onchange="checkLeaveDayConflict(this)">
                <input type="hidden" name="leave-v-date" value="${displayDate}">
                </td>
                <td><input type="number" name="leave-v" data-type="v-hour" onchange="validateInput(this); calculateLeave();">
                <input type="hidden" name="leave-v-date" value="${displayDate}">
                </td>
                <td>
                <input type="checkbox" name="leave-p" data-type="p-day" value="1" onchange="checkLeaveDayConflict(this)">
                <input type="hidden" name="leave-p-date" value="${displayDate}">
                </td>
                <td>
                <input type="number" name="leave-p" data-type="p-hour" onchange="validateInput(this); calculateLeave();">
                <input type="hidden" name="leave-p-date" value="${displayDate}">
                </td>
                <td>
                <input type="checkbox" name="leave-s" data-type="s-day" value="1" onchange="checkLeaveDayConflict(this)">
                <input type="hidden" name="leave-s-date" value="${displayDate}">
                </td>
                <td>
                <input type="number" name="leave-s" data-type="s-hour" onchange="validateInput(this); calculateLeave();">
                <input type="hidden" name="leave-s-date" value="${displayDate}">
                </td>
                <td>
                <input type="number" name="late" data-type="late-min" onchange="validateInput(this); calculateLeave();">
                <input type="hidden" name="late-date" value="${displayDate}">
                </td>
                <td>
                <input type="number" name="late-no-deduct" data-type="late-no-deduct-min" onchange="validateInput(this); calculateLeave();">
                <input type="hidden" name="late-no-deduct-date" value="${displayDate}">
                </td>
                <td>
                <div class="checkbox-group">
                <label><input type="checkbox" name="punch-card-miss" data-type="punch-in" data-date="${displayDate}" onchange="calculateLeave()">ä¸Šç­</label>
                <label><input type="checkbox" name="punch-card-miss" data-type="punch-out" data-date="${displayDate}" onchange="calculateLeave()">ä¸‹ç­</label>
                </div>
                </td>
                <td><input type="number" name="leave-m" data-type="m-hour" onchange="validateInput(this); calculateLeave();">
                <input type="hidden" name="leave-m-date" value="${displayDate}">
                </td>
                <td>
                <input type="checkbox" name="leave-f" data-type="f-day" value="1" onchange="checkLeaveDayConflict(this)">
                <input type="hidden" name="leave-f-date" value="${displayDate}">
                </td>
                <td>
                <input type="number" name="leave-f" data-type="f-hour" onchange="validateInput(this); calculateLeave();">
                <input type="hidden" name="leave-f-date" value="${displayDate}">
                </td>
                <td>
                <input type="number" name="overtime" data-type="overtime-hour" onchange="validateInput(this); calculateLeave();">
                <input type="hidden" name="overtime-date" value="${displayDate}">
                </td>                
                </tr>`;
            }

            html += '</table>';
            document.getElementById("formArea").innerHTML = html;
            document.getElementById("resultsLeave").innerText = '';
            calculateLeave(); // ç”¢ç”Ÿè¡¨æ ¼å¾Œè‡ªå‹•è¨ˆç®—
        }

        function validateInput(input) {
            let value = parseFloat(input.value) || 0;

            if (value < 0) {
                showToast("æ•¸å€¼ä¸èƒ½æ˜¯è² æ•¸ï¼");
                input.value = 0;
                return;
            }
            const dataType = input.getAttribute("data-type");
            if (dataType.includes("day") && value > 1) {
                showToast("å‡åˆ¥ï¼ˆå¤©ï¼‰ä¸èƒ½è¶…é 1 å¤©ï¼");
                input.value = 1;
            }
            if (dataType.includes("hour") && value > 8) {
                showToast("æ¯æ ¼æœ€å¤šå¡«å¯« 8 å°æ™‚ï¼");
                input.value = 8;
            }
        }

        function calculateLeave() {
            const rows = document.querySelectorAll("#formArea table tr:not(:first-child)");
            // æ¸…ç©ºè¨˜éŒ„ï¼Œé¿å…é‡è¤‡ç´¯ç©
            leaveRecords = [];
            sickRecords = [];
            lateRecords = [];
            lateNoDeductRecords = [];
            punchCardMissRecords = [];
            menstrualRecords = [];
            vacationRecords = [];
            funeralRecords = [];
            overtimeRecords = [];
            
            let vDay = 0, vHour = 0, pDay = 0, pHour = 0, sDay = 0, sHour = 0, lateMin = 0, lateNoDeductMin = 0;
            let punchInCount = 0, punchOutCount = 0;
            let mHour = 0;
            let fDay = 0, fHour = 0; // æ–°å¢å–ªå‡å¤©ã€æ™‚
            let otHour = 0; // æ–°å¢è¶…æ™‚æ™‚
            
            rows.forEach(row => {
                const date = row.querySelector("td:first-child").innerText;
                
                // ç²å–æ‰€æœ‰ç›¸é—œè¼¸å…¥æ¡†çš„å€¼
                const vDayChecked = row.querySelector("input[data-type='v-day']").checked ? 1 : 0;
                // æ³¨æ„ï¼šé€™è£¡éœ€è¦æª¢æŸ¥ input æ˜¯å¦è¢« disabled
                const vHourInput = row.querySelector("input[data-type='v-hour']");
                const vHourVal = vHourInput.disabled ? 0 : (parseFloat(vHourInput.value) || 0);

                const pDayChecked = row.querySelector("input[data-type='p-day']").checked ? 1 : 0;
                const pHourInput = row.querySelector("input[data-type='p-hour']");
                const pHourVal = pHourInput.disabled ? 0 : (parseFloat(pHourInput.value) || 0);

                const sDayChecked = row.querySelector("input[data-type='s-day']").checked ? 1 : 0;
                const sHourInput = row.querySelector("input[data-type='s-hour']");
                const sHourVal = sHourInput.disabled ? 0 : (parseFloat(sHourInput.value) || 0);

                const lateMinInput = row.querySelector("input[data-type='late-min']");
                const lateMinVal = lateMinInput.disabled ? 0 : (parseFloat(lateMinInput.value) || 0);

                const lateNoDeductMinInput = row.querySelector("input[data-type='late-no-deduct-min']");
                const lateNoDeductMinVal = lateNoDeductMinInput.disabled ? 0 : (parseFloat(lateNoDeductMinInput.value) || 0);

                const punchCardMissCheckboxes = row.querySelectorAll("input[type='checkbox'][name='punch-card-miss']");
                const punchInVal = punchCardMissCheckboxes[0].disabled ? false : punchCardMissCheckboxes[0].checked;
                const punchOutVal = punchCardMissCheckboxes[1].disabled ? false : punchCardMissCheckboxes[1].checked;

                const mHourInput = row.querySelector("input[data-type='m-hour']");
                const mHourVal = mHourInput.disabled ? 0 : (parseFloat(mHourInput.value) || 0);
                
                const fDayChecked = row.querySelector("input[data-type='f-day']").checked ? 1 : 0; // å–ªå‡å¤©
                const fHourInput = row.querySelector("input[data-type='f-hour']");
                const fHourVal = fHourInput.disabled ? 0 : (parseFloat(fHourInput.value) || 0); // å–ªå‡æ™‚

                const otHourInput = row.querySelector("input[data-type='overtime-hour']");
                const otHourVal = otHourInput.disabled ? 0 : (parseFloat(otHourInput.value) || 0); // è¶…æ™‚æ™‚
                
                // ç´¯åŠ ç¸½æ•¸
                vDay += vDayChecked;
                vHour += vHourVal;
                pDay += pDayChecked;
                pHour += pHourVal;
                sDay += sDayChecked;
                sHour += sHourVal;
                lateMin += lateMinVal;
                lateNoDeductMin += lateNoDeductMinVal;
                fDay += fDayChecked;
                fHour += fHourVal;
                otHour += otHourVal;
                
                // è¨˜éŒ„è©³ç´°å‡åˆ¥
                if (vDayChecked) vacationRecords.push({ days: 1, date: date, type: 'å¤©' });
                if (vHourVal > 0) vacationRecords.push({ hours: vHourVal, date: date, type: 'å°æ™‚' });
                if (pDayChecked) leaveRecords.push({ days: 1, date: date });
                if (pHourVal > 0) leaveRecords.push({ hours: pHourVal, date: date });
                if (sDayChecked) sickRecords.push({ days: 1, date: date });
                if (sHourVal > 0) sickRecords.push({ hours: sHourVal, date: date });
                if (lateMinVal > 0) lateRecords.push({ minutes: lateMinVal, date: date });
                if (lateNoDeductMinVal > 0) lateNoDeductRecords.push({ minutes: lateNoDeductMinVal, date: date });
                if (punchInVal) {
                    punchInCount++;
                    punchCardMissRecords.push({ type: 'ä¸Šç­', date: date });
                }
                if (punchOutVal) {
                    punchOutCount++;
                    punchCardMissRecords.push({ type: 'ä¸‹ç­', date: date });
                }
                if (mHourVal > 0) {
                    menstrualRecords.push({ hours: mHourVal, date: date });
                    mHour += mHourVal; // é€™è£¡çš„mHourç´¯åŠ ä¹Ÿæ‡‰è©²åœ¨è¨˜éŒ„ä¹‹å¤–
                }
                if (fDayChecked) funeralRecords.push({ days: 1, date: date });
                if (fHourVal > 0) funeralRecords.push({ hours: fHourVal, date: date });
                if (otHourVal > 0) overtimeRecords.push({ hours: otHourVal, date: date });
            });

            const name = document.getElementById("teacherNameLeave").value.trim();
            const head = name ? `${name}\n` : '';

            let result = '';
            if (vDay > 0 || vHour > 0) {
                result += `âœ… ç‰¹ä¼‘/è£œä¼‘ï¼š${vDay} å¤© ${vHour} å°æ™‚`;
                const vacationDetails = vacationRecords.map(record => `(${record.date} ${record.hours || record.days}${record.hours ? 'å°æ™‚' : 'å¤©'})`).join('ã€');
                if (vacationDetails) result += `      ${vacationDetails}\n`;
                else result += '\n'; // ç¢ºä¿æ›è¡Œ
            }

            const totalBufferCount = lateNoDeductRecords.length + punchInCount + punchOutCount;
            if (lateNoDeductMin > 0 || punchInCount > 0 || punchOutCount > 0) {
            let bufferString = `âœ… å…¨å‹¤ç·©è¡ï¼š`;
            const lateDetails = lateNoDeductRecords.map(record => `(${record.date} ${record.minutes}åˆ†é˜)`).join('ã€');
            const punchCardDetails = punchCardMissRecords.map(record => `(${record.date} ${record.type})`).join('ã€');

            if (lateNoDeductMin > 0) bufferString += `é²åˆ°ä¸æ‰£ ${lateDetails}`;
            if (punchInCount > 0 || punchOutCount > 0) {
            if (lateNoDeductMin > 0) bufferString += "ï¼Œ";
            bufferString += `æ¼æ‰“å¡ ${punchCardDetails}`;
            }
            if (totalBufferCount > 3) bufferString += " (æ²’æœ‰å…¨å‹¤äº†âš ï¸)";
            result += bufferString + "\n";
            }

            if (fDay > 0 || fHour > 0) {
                result += `âœ… å–ªå‡ï¼š${fDay} å¤© ${fHour} å°æ™‚`;
                const funeralDetails = funeralRecords.map(record => `(${record.date} ${record.hours || record.days}${record.hours ? 'å°æ™‚' : 'å¤©'})`).join('ã€');
                if (funeralDetails) result += `      ${funeralDetails}\n`;
                else result += '\n'; // ç¢ºä¿æ›è¡Œ
            }

            if (otHour > 0) {
                result += `âœ… è¶…æ™‚ï¼š${otHour} å°æ™‚`;
                const overtimeDetails = overtimeRecords.map(record => `(${record.date} ${record.hours}å°æ™‚)`).join('ã€');
                if (overtimeDetails) result += `      ${overtimeDetails}\n`;
                else result += '\n'; // ç¢ºä¿æ›è¡Œ
            }

            if (pDay > 0 || pHour > 0) {
                result += `âœ… äº‹å‡ï¼š${pDay} å¤© ${pHour} å°æ™‚`;
                const leaveDetails = leaveRecords.map(record => `(${record.date} ${record.hours || record.days}${record.hours ? 'å°æ™‚' : 'å¤©'})`).join('ã€');
                if (leaveDetails) result += `      ${leaveDetails}\n`;
                else result += '\n'; // ç¢ºä¿æ›è¡Œ
            }

            if (sDay > 0 || sHour > 0) {
                result += `âœ… ç—…å‡ï¼š${sDay} å¤© ${sHour} å°æ™‚`;
                const sickDetails = sickRecords.map(record => `(${record.date} ${record.hours || record.days}${record.hours ? 'å°æ™‚' : 'å¤©'})`).join('ã€');
                if (sickDetails) result += `      ${sickDetails}\n`;
                else result += '\n'; // ç¢ºä¿æ›è¡Œ
            }

            if (mHour > 0) {
                result += `âœ… ç”Ÿç†å‡ï¼š${mHour} å°æ™‚ ${mHour > 8 ? "(è¶…éé¡åº¦âš ï¸)" : ""}`;
                const mDetails = menstrualRecords.map(record => `(${record.date} ${record.hours}å°æ™‚)`).join('ã€');
                if (mDetails) result += `ã€€ã€€${mDetails}\n`;
                else result += '\n'; // ç¢ºä¿æ›è¡Œ
            }

            if (lateMin > 0) {
                result += `âœ… é²åˆ°ï¼š${lateMin} åˆ†é˜`;
                const lateDetails = lateRecords.map(record => `(${record.date} ${record.minutes}åˆ†é˜)`).join('ã€');
                if (lateDetails) result += `ã€€ã€€${lateDetails}\n`;
                else result += '\n'; // ç¢ºä¿æ›è¡Œ
            }

            const inputCashOutDays = parseFloat(document.getElementById("inputCashOutDays").value) || 0;
            const inputCashOutHours = parseFloat(document.getElementById("inputCashOutHours").value) || 0;
            if (inputCashOutDays > 0 || inputCashOutHours > 0) {
                result += `ğŸ’° é è¨ˆæŠ˜ç¾ï¼š${inputCashOutDays} å¤© ${inputCashOutHours} å°æ™‚\n`;
            }

            document.getElementById("resultsLeave").innerText = head + result;
        }

        function copyResultsLeave() {
            const resultText = document.getElementById("resultsLeave").innerText;
            navigator.clipboard.writeText(resultText).then(() => {
                showToast("å·²è¤‡è£½çµ±è¨ˆçµæœï¼");
            }, () => {
                showToast("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–å…§å®¹ï¼");
            });
        }

        function importLeaveResults() {
            let totalLeaveDays = 0;
            let totalLeaveHours = 0;
            leaveRecords.forEach(record => {
                if (record.days) totalLeaveDays += record.days;
                if (record.hours) totalLeaveHours += record.hours;
            });

            let totalSickDays = 0;
            let totalSickHours = 0;
            sickRecords.forEach(record => {
                if (record.days) totalSickDays += record.days;
                if (record.hours) totalSickHours += record.hours;
            });

            let totalLateMinutes = 0;
            lateRecords.forEach(record => {
                if (record.minutes) totalLateMinutes += record.minutes;
            });

            let totalMenstrualHours = 0;
            menstrualRecords.forEach(record => {
                if (record.hours) totalMenstrualHours += record.hours;
            });

            document.getElementById("leaveDaysSalary").value = totalLeaveDays;
            document.getElementById("leaveHoursSalary").value = totalLeaveHours;
            document.getElementById("sickDaysSalary").value = totalSickDays;
            document.getElementById("sickHoursSalary").value = totalSickHours;
            document.getElementById("lateMinutesSalary").value = totalLateMinutes;
            document.getElementById("menstrualHoursSalary").value = totalMenstrualHours;

            const teacherNameLeave = document.getElementById("teacherNameLeave").value.trim();
            if (teacherNameLeave) {
                document.getElementById("nameSalary").value = teacherNameLeave;
            }

            const inputCashOutDays = parseFloat(document.getElementById("inputCashOutDays").value) || 0;
            const inputCashOutHours = parseFloat(document.getElementById("inputCashOutHours").value) || 0;
            document.getElementById("cashOutDaysSalary").value = inputCashOutDays;
            document.getElementById("cashOutHoursSalary").value = inputCashOutHours;

            showToast("å‡åˆ¥çµ±è¨ˆçµæœå·²åŒ¯å…¥ä¸è¨ˆè–ªè¨ˆç®—ï¼");
        }
    </script>


    <hr>

    <script>
        function getValue(id) {
            const val = parseFloat(document.getElementById(id).value);
            return isNaN(val) ? 0 : val;
        }

        function calculateSalaryDeduction() {
            const name = document.getElementById("nameSalary").value.trim();
            const salary = getValue("salary");
            const leaveDays = getValue("leaveDaysSalary");
            const leaveHours = getValue("leaveHoursSalary");
            const sickDays = getValue("sickDaysSalary");
            const sickHours = getValue("sickHoursSalary");
            const lateMinutes = getValue("lateMinutesSalary");
            const menstrualHours = getValue("menstrualHoursSalary");

            // å¾å…¨å±€è®Šæ•¸ä¸­ç²å–è©³ç´°è¨˜éŒ„
            const leaveDaysNote = leaveRecords.filter(r => r.days).map(record => `ï¼ˆ${record.date} ${record.days}å¤©ï¼‰`).join('');
            const leaveHoursNote = leaveRecords.filter(r => r.hours).map(record => `ï¼ˆ${record.date} ${record.hours}å°æ™‚ï¼‰`).join('');
            const sickDaysNote = sickRecords.filter(r => r.days).map(record => `ï¼ˆ${record.date} ${record.days}å¤©ï¼‰`).join('');
            const sickHoursNote = sickRecords.filter(r => r.hours).map(record => `ï¼ˆ${record.date} ${record.hours}å°æ™‚ï¼‰`).join('');
            
            const lateNote = lateRecords.map(record => `ï¼ˆ${record.date} ${record.minutes}åˆ†é˜ï¼‰`).join('');
            const menstrualNote = menstrualRecords.map(record => `ï¼ˆ${record.date} ${record.hours}å°æ™‚ï¼‰`).join('');

            // vacationRecords åœ¨é€™è£¡ä¼¼ä¹æ²’æœ‰ç›´æ¥ç”¨æ–¼æ‰£è–ªè¨ˆç®—ï¼Œä½†æ‚¨å¯ä»¥æ ¹æ“šéœ€è¦æ·»åŠ ã€‚
            // const vacationDaysNote = vacationRecords.filter(r => r.type === "å¤©").map(record => `ï¼ˆ${record.date} ${record.days}å¤©ï¼‰`).join('');
            // const vacationHoursNote = vacationRecords.filter(r => r.type === "å°æ™‚").map(record => `ï¼ˆ${record.date} ${record.hours}å°æ™‚ï¼‰`).join('');

            if (salary <= 0) {
                document.getElementById("salaryResult").innerText = "âš ï¸ è«‹å¡«å…¥åŸå§‹æœˆè–ª";
                return;
            }

            // è¨ˆç®—åŸå§‹æœªå–æ•´çš„æ‰£æ¬¾é‡‘é¡
            const rawLeaveDayDeduct = (salary / 30) * leaveDays;
            const rawLeaveHourDeduct = (salary / 30 / 8) * leaveHours;
            const rawSickDayDeduct = (salary / 30 / 2) * sickDays;
            const rawSickHourDeduct = (salary / 30 / 8 / 2) * sickHours;
            const rawLateDeduct = (salary / 30 / 8 / 60) * lateMinutes;
            const rawMenstrualDeduct = (salary / 30 / 8 / 2) * menstrualHours;

            // ğŸ’° æŠ˜ç¾éƒ¨åˆ†ï¼ˆåŠ åœ¨ totalDeduct ä¸Šé¢ï¼‰
            const cashOutDays = getValue("cashOutDaysSalary");
            const cashOutHours = getValue("cashOutHoursSalary");

            // è¨ˆç®—åŸå§‹æœªå–æ•´çš„æŠ˜ç¾é‡‘é¡
            const rawCashOutDayBonus = (salary / 30) * cashOutDays;
            const rawCashOutHourBonus = (salary / 30 / 8) * cashOutHours;
            
            // æœ€çµ‚åŠ ç¸½æ™‚å†é€²è¡Œå››æ¨äº”å…¥ (æˆ–æ‚¨åå¥½çš„é€²ä½/æ¨å»æ–¹å¼)
            const totalDeduct = Math.round(rawLeaveDayDeduct + rawLeaveHourDeduct + rawSickDayDeduct + rawSickHourDeduct + rawLateDeduct + rawMenstrualDeduct);
            const totalCashOutBonus = Math.round(rawCashOutDayBonus + rawCashOutHourBonus);


            let formula = `${name ? name + "ï¼š" : ""}æ˜ç´°å¦‚ä¸‹ï¼š\n`;

            // é¡¯ç¤ºæ™‚ä»ä½¿ç”¨å››æ¨äº”å…¥å¾Œçš„å€‹åˆ¥é‡‘é¡ï¼Œä½†ç¸½å’Œæ˜¯åŸºæ–¼åŸå§‹å€¼
            if (leaveDays) formula += `â–äº‹å‡ ${leaveDays}å¤© Ã— ${salary}/30 = ${Math.round(rawLeaveDayDeduct)}å…ƒ ${leaveDaysNote}\n`;
            if (leaveHours) formula += `â–äº‹å‡ ${leaveHours}å°æ™‚ Ã— ${salary}/30/8 = ${Math.round(rawLeaveHourDeduct)}å…ƒ ${leaveHoursNote}\n`;
            if (sickDays) formula += `â–ç—…å‡ ${sickDays}å¤© Ã— ${salary}/30/2 = ${Math.round(rawSickDayDeduct)}å…ƒ ${sickDaysNote}\n`;
            if (sickHours) formula += `â–ç—…å‡ ${sickHours}å°æ™‚ Ã— ${salary}/30/8/2 = ${Math.round(rawSickHourDeduct)}å…ƒ ${sickHoursNote}\n`;
            if (lateMinutes) formula += `â–é²åˆ° ${lateMinutes}åˆ†é˜ Ã— ${salary}/30/8/60 = ${Math.round(rawLateDeduct)}å…ƒ ${lateNote}\n`;
            if (menstrualHours) formula += `â–ç”Ÿç†å‡ ${menstrualHours}å°æ™‚ Ã— ${salary}/30/8/2 = ${Math.round(rawMenstrualDeduct)}å…ƒ ${menstrualNote}\n`;

            formula += `ä¸æ”¯è–ªé‡‘é¡ï¼š${totalDeduct} å…ƒ\n`;
            
            // ğŸ’° é¡¯ç¤ºæŠ˜ç¾ç®—å¼ï¼ˆæ”¾åœ¨æ‰€æœ‰ â– æ‰£è–ªå…¬å¼ä¹‹å¾Œï¼‰
            if (cashOutDays) formula += `â•æŠ˜ç¾ ${cashOutDays}å¤© Ã— ${salary}/30 = ${Math.round(rawCashOutDayBonus)}å…ƒ\n`;
            if (cashOutHours) formula += `â•æŠ˜ç¾ ${cashOutHours}å°æ™‚ Ã— ${salary}/30/8 = ${Math.round(rawCashOutHourBonus)}å…ƒ\n`;
            if (cashOutDays || cashOutHours) formula += `æŠ˜ç¾ç¸½é‡‘é¡ï¼š${totalCashOutBonus} å…ƒ\n`;

            document.getElementById("salaryResult").innerText = formula;
        }

        function copyResultsSalary() {
            const text = document.getElementById("salaryResult").innerText;
            if (!text) {
                showToast("âš ï¸ å°šæœªç”¢ç”Ÿçµæœ");
                return;
            }
            navigator.clipboard.writeText(text)
                .then(() => showToast("âœ… å·²è¤‡è£½ç®—å¼ï¼"))
                .catch(err => showToast("âŒ è¤‡è£½å¤±æ•—ï¼š" + err));
        }
    </script>
    <hr>
    <script>   
        function sendToIframe() {
         const data = document.getElementById('resultsLeave').innerText;
         const iframe = document.querySelector('iframe');
         iframe.contentWindow.postMessage({ type: 'IMPORT_LEAVE_DATA', payload: data }, 'https://zh22331997.github.io');
        }
    </script>
    <script>
        function showToast(message, duration = 2500) {
         const toast = document.getElementById('toast');
         toast.textContent = message;
         toast.style.opacity = 1;
         setTimeout(() => {
         toast.style.opacity = 0;
         }, duration);
        }
    </script>
   
</body>
</html>
