<!doctype html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å‰©é¤˜å¹´å‡è¨ˆç®—æ©Ÿ(ä¸€å¤©8å°æ™‚)</title>
  <style>
    :root{
      --border:#d0d7de;
      --bg:#f6f8fa;
      --text:#111827;
      --muted:#6b7280;
      --danger:#b91c1c;
      --ok:#065f46;
      --card:#ffffff;
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif;
      color: var(--text);
      margin: 0;
      background: linear-gradient(180deg, #fff, var(--bg));
    }
    .wrap{
      max-width: 920px;
      margin: 24px auto;
      padding: 16px;
    }
    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.06);
      padding: 16px;
    }
    h1{
      font-size: 20px;
      margin: 0 0 12px 0;
    }
    .hint{
      margin: 0 0 14px 0;
      color: var(--muted);
      line-height: 1.5;
      font-size: 14px;
    }
    table{
      width: 100%;
      border-collapse: collapse;
      overflow: hidden;
      border-radius: 12px;
      border: 1px solid var(--border);
    }
    th, td{
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      vertical-align: middle;
    }
    thead th{
      background: #f3f4f6;
      text-align: left;
      font-weight: 700;
      font-size: 14px;
    }
    tbody tr:last-child td{
      border-bottom: none;
    }
    input[type="number"]{
      width: 120px;
      max-width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 14px;
      outline: none;
    }
    input[type="number"]:focus{
      border-color: #6b7280;
      box-shadow: 0 0 0 3px rgba(107,114,128,0.15);
    }
    .row-actions{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    button{
      border: 1px solid var(--border);
      background: #fff;
      padding: 8px 10px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover{ background:#f9fafb; }
    .btn-primary{
      border-color: #111827;
      background: #111827;
      color: #fff;
    }
    .btn-primary:hover{ background:#0b1220; }
    .btn-danger{
      border-color: #ef4444;
      color: #b91c1c;
      background: #fff;
    }
    .btn-danger:hover{ background: #fff5f5; }
    .summary{
      display: grid;
      gap: 10px;
      margin-top: 14px;
      padding: 12px;
      border: 1px dashed var(--border);
      border-radius: 12px;
      background: #fcfcfd;
    }
    .summary .line{
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: baseline;
      justify-content: space-between;
    }
    .big{
      font-size: 18px;
      font-weight: 800;
    }
    .tag{
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #3730a3;
      border: 1px solid rgba(55,48,163,0.15);
    }
    .status-ok{ color: var(--ok); font-weight: 700; }
    .status-bad{ color: var(--danger); font-weight: 800; }
    .muted{ color: var(--muted); }
    .footer{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.5;
    }
    .nowrap{ white-space: nowrap; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>å¹´å‡è¨ˆç®—å™¨ <span class="tag">ä¸€å¤© = 8 å°æ™‚</span></h1>
      <p class="hint">
        å…ˆè¼¸å…¥ã€Œå¹´å‡ç¸½é‡ã€ï¼Œå†ç”¨ä¸‹é¢çš„ã€Œæ‰£é™¤ã€å€å¡Šæ–°å¢å¤šç­†æ‰£é™¤ç´€éŒ„ã€‚ç³»çµ±æœƒè‡ªå‹•æ›ç®—èˆ‡è¨ˆç®—å‰©é¤˜ã€‚
        <span class="muted">ï¼ˆäº¤çµ¦å®ƒç®—å°±å¥½ï¼Œä½ çš„è…¦è¢‹æ‹¿ä¾†æ”¾å‡æ¯”è¼ƒé‡è¦ ğŸ˜Œï¼‰</span>
      </p>

      <table aria-label="å¹´å‡è¡¨æ ¼">
        <thead>
          <tr>
            <th>é …ç›®</th>
            <th class="nowrap">å¹´å‡(å¤©)</th>
            <th class="nowrap">å¹´å‡(å°æ™‚)</th>
            <th style="text-align:right;">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>å¹´å‡ç¸½é‡</strong></td>
            <td><input id="totalDays" type="number" min="0" step="1" value="0" /></td>
            <td><input id="totalHours" type="number" min="0" step="0.5" value="0" /></td>
            <td style="text-align:right;" class="muted">â€”</td>
          </tr>

          <tr>
            <td colspan="4" style="background:#fafafa;">
              <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
                <div>
                  <strong>æ‰£é™¤ï¼ˆå¯å‹•æ…‹å¢è¡Œï¼‰</strong>
                  <span class="muted">æ¯ä¸€è¡Œä»£è¡¨ä¸€æ¬¡æ‰£é™¤</span>
                </div>
                <div class="row-actions">
                  <button id="addRowBtn" class="btn-primary" type="button">æ–°å¢ä¸€ç­†æ‰£é™¤</button>
                  <button id="resetBtn" type="button">æ¸…ç©ºæ‰£é™¤</button>
                </div>
              </div>
            </td>
          </tr>

          <!-- å‹•æ…‹æ‰£é™¤åˆ—æœƒæ’åœ¨é€™è£¡ -->
          <tr id="rowsAnchor">
            <td class="muted" colspan="4">ç›®å‰æ²’æœ‰æ‰£é™¤ç´€éŒ„ã€‚é»å³ä¸Šè§’ã€Œæ–°å¢ä¸€ç­†æ‰£é™¤ã€é–‹å§‹ã€‚</td>
          </tr>
        </tbody>
      </table>

      <div class="summary" aria-live="polite">
        <div class="line">
          <div class="muted">å·²æ‰£é™¤ç¸½è¨ˆ</div>
          <div><span id="usedDays">0</span> å¤© <span id="usedHours">0</span> å°æ™‚</div>
        </div>

        <div class="line">
          <div class="big">å¹´å‡å‰©é¤˜</div>
          <div class="big"><span id="remainDays">0</span> å¤© <span id="remainHours">0</span> å°æ™‚</div>
        </div>

        <!-- âœ… ä½ è¦çš„ï¼šå‰©é¤˜æ›ç®—æˆå°æ™‚ -->
        <div class="line">
          <div class="muted">æ›ç®—æˆ</div>
          <div><span id="remainTotalHours">0</span> å°æ™‚</div>
        </div>

        <div class="line">
          <div class="muted">ç‹€æ…‹</div>
          <div id="statusText" class="status-ok">OKï¼šé‚„æœ‰å¹´å‡å¯ä»¥ç”¨ âœ…</div>
        </div>
      </div>

      <div class="footer">
        å°æé†’ï¼šæ‰€æœ‰è¨ˆç®—ä»¥ã€Œå°æ™‚ã€ç‚ºåº•å±¤å–®ä½ï¼ˆå¤©æœƒè‡ªå‹•æ›ç®—æˆ 8 å°æ™‚ï¼‰ï¼Œæœ€å¾Œå†æ›å›å¤©/å°æ™‚é¡¯ç¤ºã€‚
        å¦‚æœæ‰£åˆ°è² æ•¸ï¼Œä»£è¡¨å·²ç¶“è¶…æ‰£ï¼Œæˆ‘ä¹Ÿæœƒè€å¯¦çµ¦ä½ è­¦å‘Šï¼ˆä¸ç„¶ä½ æœƒä»¥ç‚ºè‡ªå·±å¹´å‡æœƒè‡ªå‹•å¢æ®–ï¼‰ã€‚
      </div>
    </div>
  </div>

<script>
  (function(){
    const HOURS_PER_DAY = 8;

    const totalDaysEl = document.getElementById('totalDays');
    const totalHoursEl = document.getElementById('totalHours');

    const addRowBtn = document.getElementById('addRowBtn');
    const resetBtn = document.getElementById('resetBtn');

    const rowsAnchor = document.getElementById('rowsAnchor');

    const usedDaysEl = document.getElementById('usedDays');
    const usedHoursEl = document.getElementById('usedHours');

    const remainDaysEl = document.getElementById('remainDays');
    const remainHoursEl = document.getElementById('remainHours');
    const remainTotalHoursEl = document.getElementById('remainTotalHours'); // âœ… æ–°å¢

    const statusTextEl = document.getElementById('statusText');

    let rowIdSeq = 0;

    function safeNumber(v){
      const n = Number(v);
      return Number.isFinite(n) && n >= 0 ? n : 0;
    }

    function formatNumber(n){
      // é¡¯ç¤ºç”¨ï¼šå»æ‰ -0ã€å»æ‰å¤šé¤˜çš„ .00
      if (Object.is(n, -0)) n = 0;
      const s = (Math.round(n * 100) / 100).toString();
      return s;
    }

    function hoursToDayHourUnsigned(totalHours){
      // å°‡ã€Œéè² å°æ™‚ã€æ›æˆ å¤©/å°æ™‚ï¼ˆå°æ™‚å¯åˆ°å°æ•¸ï¼‰
      const eps = 1e-9;
      const h = Math.max(0, totalHours);
      const days = Math.floor((h + eps) / HOURS_PER_DAY);
      const hours = +(h - days * HOURS_PER_DAY).toFixed(2);

      // ä¿®æ­£æµ®é»èª¤å·®
      const bump = (Math.abs(hours - HOURS_PER_DAY) < 1e-6);
      return bump ? { days: days + 1, hours: 0 } : { days, hours };
    }

    function hoursToDayHourSigned(totalHours){
      // âœ… å…è¨±è² æ•¸ï¼š-10 å°æ™‚ => -1 å¤© -2 å°æ™‚ï¼ˆä¸€å¤© 8 å°æ™‚ï¼‰
      if (totalHours >= 0){
        const r = hoursToDayHourUnsigned(totalHours);
        return { days: r.days, hours: r.hours };
      }
      const abs = Math.abs(totalHours);
      const r = hoursToDayHourUnsigned(abs);
      const d = -r.days;
      const h = -r.hours;
      return { days: Object.is(d, -0) ? 0 : d, hours: Object.is(h, -0) ? 0 : h };
    }

    function getAllDeductRows(){
      return Array.from(document.querySelectorAll('tr[data-deduct-row="1"]'));
    }

    function compute(){
      const totalDays = safeNumber(totalDaysEl.value);
      const totalHours = safeNumber(totalHoursEl.value);

      const totalInHours = totalDays * HOURS_PER_DAY + totalHours;

      let usedInHours = 0;

      const rows = getAllDeductRows();
      for(const tr of rows){
        const dEl = tr.querySelector('input[data-role="deduct-days"]');
        const hEl = tr.querySelector('input[data-role="deduct-hours"]');

        const d = safeNumber(dEl.value);
        const h = safeNumber(hEl.value);

        usedInHours += d * HOURS_PER_DAY + h;
      }

      const usedDH = hoursToDayHourUnsigned(usedInHours);
      const remainInHours = totalInHours - usedInHours;

      // âœ… å‰©é¤˜å…è¨±é¡¯ç¤ºè² æ•¸
      const remainDH = hoursToDayHourSigned(remainInHours);

      usedDaysEl.textContent = formatNumber(usedDH.days);
      usedHoursEl.textContent = formatNumber(usedDH.hours);

      remainDaysEl.textContent = formatNumber(remainDH.days);
      remainHoursEl.textContent = formatNumber(remainDH.hours);

      // âœ… æ–°å¢ï¼šå‰©é¤˜æ›ç®—æˆå°æ™‚
      remainTotalHoursEl.textContent = formatNumber(Math.round(remainInHours * 100) / 100);

      if(remainInHours < -1e-9){
        statusTextEl.textContent = "è­¦å‘Šï¼šå¹´å‡ä¸å¤ ç”¨äº†ï¼ˆå·²è¶…æ‰£ï¼‰âš ï¸";
        statusTextEl.classList.remove('status-ok');
        statusTextEl.classList.add('status-bad');
      }else{
        statusTextEl.textContent = "OKï¼šé‚„æœ‰å¹´å‡å¯ä»¥ç”¨ âœ…";
        statusTextEl.classList.remove('status-bad');
        statusTextEl.classList.add('status-ok');
      }

      if(rows.length === 0){
        rowsAnchor.style.display = '';
      }else{
        rowsAnchor.style.display = 'none';
      }
    }

    function createDeductRow(days=0, hours=0){
      rowIdSeq += 1;
      const tr = document.createElement('tr');
      tr.setAttribute('data-deduct-row', '1');
      tr.dataset.rowId = String(rowIdSeq);

      tr.innerHTML = `
        <td>æ¸›</td>
        <td><input type="number" min="0" step="1" value="${days}" data-role="deduct-days" /></td>
        <td><input type="number" min="0" step="0.5" value="${hours}" data-role="deduct-hours" /></td>
        <td style="text-align:right;">
          <button type="button" class="btn-danger" data-role="delete-row">åˆªé™¤</button>
        </td>
      `;

      rowsAnchor.parentNode.insertBefore(tr, rowsAnchor);

      const dEl = tr.querySelector('input[data-role="deduct-days"]');
      const hEl = tr.querySelector('input[data-role="deduct-hours"]');
      dEl.addEventListener('input', compute);
      hEl.addEventListener('input', compute);

      tr.querySelector('button[data-role="delete-row"]').addEventListener('click', () => {
        tr.remove();
        compute();
      });

      compute();
    }

    function resetDeduct(){
      for(const tr of getAllDeductRows()){
        tr.remove();
      }
      compute();
    }

    totalDaysEl.addEventListener('input', compute);
    totalHoursEl.addEventListener('input', compute);

    addRowBtn.addEventListener('click', () => createDeductRow(0, 0));
    resetBtn.addEventListener('click', resetDeduct);

    compute();
  })();
</script>
</body>
</html>
